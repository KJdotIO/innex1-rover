### EKF Configuration for University of Leicester Lunabotics Rover ###
# This node fuses sensors to provide a smooth odom -> base_footprint transform.
# See the Wiki (Localisation.md) for a detailed breakdown of the trust matrices.

ekf_filter_node:
  ros__parameters:
    use_sim_time: true
    frequency: 50.0

    # Planar environment mode (ignores Z, Roll, and Pitch)
    two_d_mode: true

    publish_acceleration: true
    publish_tf: true

    # Coordinate Frames
    map_frame: map
    odom_frame: odom
    base_link_frame: base_footprint
    world_frame: odom

    # Matrix Key:
    # [X,  Y,  Z,
    #  Roll, Pitch, Yaw,
    #  VX, VY, VZ,
    #  VRoll, VPitch, VYaw,
    #  AX, AY, AZ]

    # Wheel Odometry (/odom)
    # Strategy: Currently trusting Gazebo's absolute position (X, Y) to combat insane drift 
    # in simulation. Real-world implementation should set these to false and rely on velocity.
    odom0: /odom
    odom0_config: [true,  true,  false,
                  false, false, false,
                  true,  false, false,
                  false, false, true,
                  false, false, false]

    # IMU (/imu/data_raw)
    # Strategy: Primary reference for relative Yaw and rotation speed.
    imu0: /imu/data_raw
    imu0_config: [false, false, false,
                  false, false, true,
                  false, false, false,
                  false, false, true,
                  true,  false, false]

    # Visual Odometry (/visual_odometry)
    # Hotswap point for cuVSLAM or rtabmap_odom.
    odom1: /visual_odometry
    odom1_config: [true,  true,  false,
                  false, false, false,
                  false, false, false,
                  false, false, false,
                  false, false, false]
