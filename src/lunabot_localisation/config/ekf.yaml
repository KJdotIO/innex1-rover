### Dual EKF Configuration ###
# Local EKF: smooth odom -> base_footprint (continuous, never jumps)
# Global EKF: map -> odom (jumps when AprilTag seen, corrects drift)

ekf_filter_node_odom:
  ros__parameters:
    use_sim_time: true
    frequency: 50.0
    two_d_mode: true
    publish_acceleration: true
    publish_tf: true

    map_frame: map
    odom_frame: odom
    base_link_frame: base_footprint
    world_frame: odom

    # [X, Y, Z, Roll, Pitch, Yaw, VX, VY, VZ, VRoll, VPitch, VYaw, AX, AY, AZ]

    # Wheel odometry: position + velocity
    odom0: /odom
    odom0_config:
      [
        true,
        true,
        false,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
      ]

    # IMU: yaw orientation + angular velocity + linear acceleration
    imu0: /imu/data_raw
    imu0_config:
      [
        false,
        false,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        false,
        true,
        true,
        false,
        false,
      ]

    # Visual odometry: position only
    odom1: /visual_odometry
    odom1_config:
      [
        true,
        true,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
      ]

ekf_filter_node_map:
  ros__parameters:
    use_sim_time: true
    frequency: 50.0
    two_d_mode: true
    publish_acceleration: false
    publish_tf: true

    map_frame: map
    odom_frame: odom
    base_link_frame: base_footprint
    world_frame: map

    # [X, Y, Z, Roll, Pitch, Yaw, VX, VY, VZ, VRoll, VPitch, VYaw, AX, AY, AZ]

    # Same continuous sources as local EKF
    odom0: /odom
    odom0_config:
      [
        true,
        true,
        false,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
      ]

    imu0: /imu/data_raw
    imu0_config:
      [
        false,
        false,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        false,
        true,
        true,
        false,
        false,
      ]

    odom1: /visual_odometry
    odom1_config:
      [
        true,
        true,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
      ]

    # AprilTag pose correction (discontinuous, only in global EKF)
    pose0: /tag_pose
    pose0_config:
      [
        true,
        true,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
      ]
    pose0_differential: false
    pose0_relative: false
    pose0_rejection_threshold: 5.0
